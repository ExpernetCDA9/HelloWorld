<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Inscription Utilisateur</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
      html, body { height: 100%; }
      body { overflow-x: hidden; }

      /* Canvas: cach√© par d√©faut, visible en th√®me Matrix */
      #matrixCanvas{
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
        opacity: 0.9;
        display: none;
      }
      .matrix-content { position: relative; z-index: 1; }

      /* ===================== Th√®me Matrix ===================== */
      body.theme-matrix{
        --matrix-bg:#000000;
        --matrix-primary:#00ff9c;
        --matrix-primary-2:#00d47f;
        --matrix-text:#c3ffd8;
        --matrix-dim:#0b1f16;
        --matrix-border: rgba(0,255,156,0.35);
        background: var(--matrix-bg);
        color: var(--matrix-text);
        font-family: "Courier New", ui-monospace, Menlo, Monaco, Consolas, monospace;
      }
      body.theme-matrix #matrixCanvas{ display:block; }
      body.theme-matrix h1, body.theme-matrix h2 { text-shadow: 0 0 10px rgba(0,255,156,.6); color: var(--matrix-primary); }
      body.theme-matrix .card {
        background: rgba(0,0,0,0.55);
        border: 1px solid var(--matrix-border);
        box-shadow: 0 0 18px rgba(0,255,156,0.18), inset 0 0 30px rgba(0,255,156,0.05);
        backdrop-filter: blur(2px);
        animation: cardGlow 4s ease-in-out infinite alternate;
      }
      @keyframes cardGlow {
        from { box-shadow: 0 0 12px rgba(0,255,156,0.12), inset 0 0 20px rgba(0,255,156,0.03); }
        to   { box-shadow: 0 0 26px rgba(0,255,156,0.28), inset 0 0 40px rgba(0,255,156,0.08); }
      }
      body.theme-matrix .form-label, body.theme-matrix .table { color: var(--matrix-text); }
      body.theme-matrix .form-control, body.theme-matrix .form-select {
        background: var(--matrix-dim);
        border-color: var(--matrix-border);
        color: var(--matrix-text);
      }
      body.theme-matrix .form-control::placeholder { color: rgba(195,255,216,0.6); }
      body.theme-matrix .form-control:focus {
        background: #0c2419;
        color: var(--matrix-text);
        border-color: var(--matrix-primary);
        box-shadow: 0 0 0 .2rem rgba(0,255,156,.25), 0 0 14px rgba(0,255,156,.3);
      }
      body.theme-matrix .btn-primary{
        background: linear-gradient(135deg, var(--matrix-primary), var(--matrix-primary-2));
        border-color: var(--matrix-primary-2);
        color: #00150b;
        text-shadow: 0 0 6px rgba(0,0,0,0.4);
        box-shadow: 0 0 16px rgba(0,255,156,.35);
      }
      body.theme-matrix .btn-primary:hover{ filter: brightness(1.1); box-shadow: 0 0 22px rgba(0,255,156,.55); }
      body.theme-matrix .btn-outline-secondary{ color: var(--matrix-text); border-color: var(--matrix-border); }
      body.theme-matrix .btn-outline-secondary:hover{ background: #143726; border-color: var(--matrix-primary); color: var(--matrix-text); }
      body.theme-matrix .invalid-feedback { color: #ff8a8a; }
      body.theme-matrix .form-hint { font-size: .875rem; color: #7dd7a9; }
      body.theme-matrix .table-section { display: none; }
      body.theme-matrix table.table { color: var(--matrix-text); }
      body.theme-matrix table.table thead th { border-bottom: 1px solid var(--matrix-border); color: var(--matrix-primary); }
      body.theme-matrix table.table tbody tr { border-color: rgba(0,255,156,0.15); }

      /* ===================== Th√®me Classique ===================== */
      body.theme-classic{
        background: #f7f7fb;
        color: #212529;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      body.theme-classic .card{ background: #fff; border: 1px solid rgba(0,0,0,.075); box-shadow: 0 8px 20px rgba(0,0,0,0.06); animation: none; }
      body.theme-classic .form-hint{ color: #6c757d; }
      body.theme-classic .table-section { display: none; }
    </style>
  </head>
  <body class="theme-matrix">
    <canvas id="matrixCanvas" aria-hidden="true"></canvas>
    <div class="container py-4 matrix-content">
      <div class="d-flex justify-content-end align-items-center mb-3">
        <button id="themeToggle" class="btn btn-sm btn-secondary">Basculer en th√®me classique</button>
      </div>
      <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
          <div class="card">
            <div class="card-body p-4">
              <h1 class="h3 mb-3 text-center">Inscription</h1>
              <p class="text-center mb-4" style="color:#8fe9bb">Entrez vos informations pour cr√©er un compte.</p>

              <form id="signupForm" class="needs-validation" novalidate>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email" placeholder="prenom.nom@example.com" required>
                  <div class="invalid-feedback">Veuillez saisir une adresse email valide.</div>
                </div>

                <div class="mb-3">
                  <label for="password" class="form-label">Mot de passe</label>
                  <div class="input-group">
                    <input type="password"
                           class="form-control"
                           id="password"
                           name="password"
                           minlength="8"
                           pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{8,}"
                           aria-describedby="pwdHelp"
                           required>
                    <button class="btn btn-outline-secondary" type="button" id="togglePwd" aria-label="Afficher/masquer le mot de passe">üëÅÔ∏è</button>
                    <div class="invalid-feedback">8+ caract√®res, au moins 1 minuscule, 1 majuscule et 1 symbole.</div>
                  </div>
                  <div id="pwdHelp" class="form-hint mt-1">8+ caract√®res, inclure: 1 minuscule, 1 majuscule, 1 symbole.</div>
                </div>

                <div class="mb-3">
                  <label for="passwordConfirm" class="form-label">Confirmer le mot de passe</label>
                  <input type="password" class="form-control" id="passwordConfirm" name="passwordConfirm" required>
                  <div class="invalid-feedback">Les mots de passe ne correspondent pas.</div>
                </div>

                <div class="mb-3">
                  <label for="dob" class="form-label">Date de naissance</label>
                  <input type="date" class="form-control" id="dob" name="dob" required>
                  <div class="invalid-feedback">La date doit √™tre ant√©rieure √† aujourd'hui.</div>
                </div>

                <div class="d-grid gap-2">
                  <button type="submit" class="btn btn-primary">S'inscrire</button>
                </div>
              </form>
            </div>
          </div>

          <section id="usersSection" class="table-section mt-4">
            <div class="card">
              <div class="card-body p-4">
                <h2 class="h5 mb-3">Utilisateurs du syst√®me</h2>
                <div class="table-responsive">
                  <table class="table table-striped align-middle mb-0" id="usersTable">
                    <thead>
                      <tr>
                        <th scope="col">Email</th>
                        <th scope="col">Date de naissance</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

        </div>
      </div>
    </div>

    <script>
      // ============== Animation Matrix (pluie de caract√®res) ==============
      (function matrixRain(){
        const canvas = document.getElementById('matrixCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        // Contr√¥le global d'activation du rendu Matrix
        window.matrix = { enabled: true };

        function resize(){
          const dpr = window.devicePixelRatio || 1;
          canvas.width = Math.floor(window.innerWidth * dpr);
          canvas.height = Math.floor(window.innerHeight * dpr);
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
          initDrops();
        }

        const letters = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%&+*<>/\\';
        const chars = letters.split('');
        let fontSize = 16;
        let columns = 0;
        let drops = [];
        let speed = 0.45; // vitesse plus lente (caract√®res par frame)

        function initDrops(){
          fontSize = Math.max(14, Math.min(22, Math.floor(window.innerWidth / 60)));
          columns = Math.ceil(window.innerWidth / fontSize);
          drops = new Array(columns).fill(0).map(() => Math.floor(Math.random() * -50));
          ctx.font = fontSize + "px 'Courier New', monospace";
        }

        function draw(){
          // Effet d'effacement progressif
          ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          if (!window.matrix.enabled) { requestAnimationFrame(draw); return; }

          for (let i = 0; i < drops.length; i++) {
            const x = i * fontSize;
            const y = drops[i] * fontSize;
            const char = chars[Math.floor(Math.random() * chars.length)];

            ctx.fillStyle = 'rgba(0,255,156,0.95)';
            ctx.fillText(char, x, y);

            ctx.fillStyle = 'rgba(0,200,122,0.65)';
            ctx.fillText(char, x, y - fontSize);

            if (y > window.innerHeight && Math.random() > 0.975) {
              drops[i] = Math.floor(Math.random() * -30);
            }
            drops[i] += speed;
          }
          requestAnimationFrame(draw);
        }

        window.addEventListener('resize', resize);
        resize();
        requestAnimationFrame(draw);
      })();

      // ===================== Formulaire & validations =====================
      const users = [
        { email: 'alice@example.com', dob: '1990-05-12' },
        { email: 'bob@example.com',   dob: '1985-11-03' },
      ];

      const form = document.getElementById('signupForm');
      const emailInput = document.getElementById('email');
      const pwdInput = document.getElementById('password');
      const confirmInput = document.getElementById('passwordConfirm');
      const dobInput = document.getElementById('dob');
      const usersSection = document.getElementById('usersSection');
      const usersTableBody = document.querySelector('#usersTable tbody');
      const togglePwdBtn = document.getElementById('togglePwd');
      const themeToggleBtn = document.getElementById('themeToggle');

      // ============== Th√®me: bascule Matrix / Classique ==============
      const THEME_KEY = 'theme';
      function applyTheme(theme){
        const body = document.body;
        const isMatrix = theme === 'matrix';
        body.classList.toggle('theme-matrix', isMatrix);
        body.classList.toggle('theme-classic', !isMatrix);
        if (window.matrix) window.matrix.enabled = isMatrix;
        // Texte du bouton
        themeToggleBtn.textContent = isMatrix ? 'Basculer en th√®me classique' : 'Basculer en th√®me Matrix';
      }
      // Charger pr√©f√©rence
      (function initTheme(){
        const saved = localStorage.getItem(THEME_KEY);
        applyTheme(saved === 'classic' ? 'classic' : 'matrix');
      })();
      // Bascule sur clic et sauvegarde
      themeToggleBtn.addEventListener('click', () => {
        const isMatrix = document.body.classList.contains('theme-matrix');
        const next = isMatrix ? 'classic' : 'matrix';
        localStorage.setItem(THEME_KEY, next);
        applyTheme(next);
      });

      (function setMaxDob() {
        const todayISO = new Date().toISOString().split('T')[0];
        dobInput.setAttribute('max', todayISO);
      })();

      togglePwdBtn.addEventListener('click', () => {
        const isPwd = pwdInput.type === 'password';
        pwdInput.type = isPwd ? 'text' : 'password';
        togglePwdBtn.setAttribute('aria-pressed', isPwd ? 'true' : 'false');
      });

      function syncConfirmValidity(showEmptyError = false) {
        if (!confirmInput) return;
        const pwd = pwdInput.value;
        const conf = confirmInput.value;
        if (conf.length === 0) {
          confirmInput.setCustomValidity(showEmptyError ? 'Veuillez confirmer le mot de passe' : '');
          return;
        }
        if (pwd === conf) {
          confirmInput.setCustomValidity('');
        } else {
          confirmInput.setCustomValidity('Les mots de passe ne correspondent pas');
        }
      }
      pwdInput.addEventListener('input', () => syncConfirmValidity(false));
      confirmInput.addEventListener('input', () => syncConfirmValidity(false));

      function isDobValidStrict(dateStr) {
        if (!dateStr) return false;
        const d = new Date(dateStr);
        if (Number.isNaN(d.getTime())) return false;
        const now = new Date();
        const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        return d < startOfToday;
      }

      function renderUsers() {
        usersTableBody.innerHTML = '';
        users.forEach(u => {
          const tr = document.createElement('tr');
          const tdEmail = document.createElement('td');
          tdEmail.textContent = u.email;
          const tdDob = document.createElement('td');
          const parts = u.dob.split('-');
          const dobDisplay = parts.length === 3 ? `${parts[2]}/${parts[1]}/${parts[0]}` : u.dob;
          tdDob.textContent = dobDisplay;
          tr.append(tdEmail, tdDob);
          usersTableBody.appendChild(tr);
        });
        usersSection.style.display = 'block';
      }

      function validatePassword(pwd) {
        const re = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{8,}$/;
        return re.test(pwd);
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        dobInput.setCustomValidity('');
        pwdInput.setCustomValidity('');
        confirmInput.setCustomValidity('');

        const emailOK = emailInput.checkValidity();
        const pwdOK = validatePassword(pwdInput.value);
        if (!pwdOK) pwdInput.setCustomValidity('Mot de passe non conforme');
        const confirmOK = pwdInput.value === confirmInput.value && confirmInput.value.length > 0;
        if (!confirmOK) syncConfirmValidity(true);
        const dobOK = isDobValidStrict(dobInput.value);
        if (!dobOK) dobInput.setCustomValidity('Date invalide');

        if (emailOK && pwdOK && confirmOK && dobOK) {
          users.push({ email: emailInput.value.trim(), dob: dobInput.value });
          renderUsers();
          form.reset();
          form.classList.remove('was-validated');
          const todayISO = new Date().toISOString().split('T')[0];
          dobInput.setAttribute('max', todayISO);
          pwdInput.setCustomValidity('');
          confirmInput.setCustomValidity('');
        } else {
          form.classList.add('was-validated');
        }
      });
    </script>
  </body>
  </html>
